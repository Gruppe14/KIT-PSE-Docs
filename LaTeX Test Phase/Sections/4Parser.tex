\section{Parser}

TODO: Struktur ordnen und gegebenfalls erweitern
\subsection{Parsing} 
\subsubsection{Task determination} 
When having too many threads (10+), sometimes a thread stopped working. This caused the counter for finished tasks
to be stuck under the number of threads and the program not to get finished.
So we implemented a watchdogtimer which replaces a thread by a new one, if said thread doesn't finish a line for a 
predefinied amount of time. (standard = 2 seconds)

\subsubsection{Negative or too high poolsize}
The parser works with a pool of threads, which are created when parsing. In the ParserMediator there is
a variable poolsize, which is the used poolsize for parsing.
When using a negative or a really high number (tried Integer.MAX\_VALUE), the program crashes. 
So we implemented a check for the poolsize, which looks if it is between 1 and 50 and stops parsing if it isn't.

\subsubsection{NullPointerExceptions when correct file doesn't exist}
sp\_parser.Logfile had a check, if the file which is given to it is actually existent. It used the file-class from java
and got a NullPointerException, which was caught and used as an indicator, that there is no file for the correct name.

This worked, but to improve our program, we used a class called FileHelper, which creates the file-object one time and
returns it when needed, because other parts of the program need the file too. It didn't return a NullPointerException when 
the file doesn't exist, so this check got overrun and the parser "thought" that there is a correct file which wasn't.
This caused the program to crash. Fixed by checking for null instead of catching a NullPointerException

\subsubsection{.trim()}
Some log files contain unneeded whitespace, which produce incorrect data. 
This was fixed by adding the \texttt{trim}-command in StringRow.split() and StringMapRow.split()

\subsubsection{Anonymous Proxy}
Sometimes the city- and country-name of an IP returned Anynomous Proxy, which is now replaced by "other" to fit in with 
the other undefined countries and cities.

\subsection{Check for missing/empty parts}
The parser now checks if a part of the line which is parsed is missing or empty. If it is, the line is deleted and 
linesDeleted gets incremented.

\subsection{Only accept when enough lines submitted}
Added "final static double CORRECT", a double between 0 and 100, which indicates how many percent of the lines need to be
submitted correctly for the ParserMediator to return true to the facade.

\subsection{Reset}
The parser now resets after he finished parsing a logfile, so that another file can be parsed.

\ldots 
\subsection{Automic tests}

\subsubsection{Parsing}

\begin{itemize}

\item smallParseTestStandardSize - parse 10 lines, standard (5) poolsize
\item smallParseTestSize10 - parse 10 lines, poolsize 10
\item smallParseTestTooBig - parse 10 lines, poolsize 100 -> Error \#2: ParserMediator.poolsizeParsing is bigger than 50.
\item negativePoolsize - parse 10 lines, poolsize -2 -> Error \#1: ParserMediator.poolsizeParsing is smaller than 1.
\item nonexistentFile - try to parse nonexistent file -> Error \#5: The path is wrong.
\item wrongFile - try to parse from an empty .txt file -> Error \#5: The path is wrong.
\item flawedFile - try to parse from a file with a typo in "type" -> Error \#11: The configuration file got a different format.
\item mediumParseTestStandardSize - parse 1000 lines, standard (5) poolsize
\item mediumParseTestSize50 - parse 1000 lines, poolsize 50
\item bigParseTestStandardSize - parse ~30k lines, standard (5) poolsize
\item veryBigParseTestStandardSize (IGNORED) - parse a whole month, standard (5) poolsize, ignored because it may take hours 
to finish.
\item smallParseTestEmptyLine - parse 10 lines with an empty line in between
\item testIntegerMistake - parse 10 lines with year "2013apples" instead of "2013"
\item testMissingPart - parse 10 lines with one line with a missing statement
\item testEmptyPart - parse 10 lines with one empty statement and one empty year
\item doubleParsing - parse 1000 lines twice from seperate files

\end{itemize}

\subsection{Test scenario}
% old
% new
% result